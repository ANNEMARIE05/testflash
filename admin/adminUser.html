<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Admin</title>
    <link rel="shortcut icon" href="/assets/img/log.jpeg" type="image/jpeg">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body class="bg-gray-50 font-sans">
    <div class="flex h-screen">
        <aside id="menu" class="bg-white shadow-lg w-64 fixed h-full z-30 transform -translate-x-full lg:translate-x-0 transition-transform duration-300">
            <div class="p-6 bg-bleu-principal flex justify-between items-center">
                <h2 class="text-white text-xl font-bold">Admin Panel</h2>
                <button id="btnFermer" class="lg:hidden text-white hover:text-gray-200">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            
            <nav class="mt-8">
                <a href="dashboardAdmin.html" class="flex items-center px-6 py-3 text-gray-700 hover:bg-gray-100 transition-colors">
                    <i class="fas fa-tachometer-alt mr-3"></i>
                    Dashboard
                </a>
                <a href="adminPronostic.html" class="flex items-center px-6 py-3 text-gray-700 hover:bg-gray-100 transition-colors">
                    <i class="fas fa-plus-circle mr-3"></i>
                    Nouveau Pronostic
                </a>
                <a href="adminMesProno.html" class="flex items-center px-6 py-3 text-gray-700 hover:bg-gray-100 transition-colors">
                    <i class="fas fa-futbol mr-3"></i>
                    Mes Pronostiques
                </a>
                <a href="adminCoordonnee.html" class="flex items-center px-6 py-3 text-gray-700 hover:bg-gray-100 transition-colors">
                    <i class="fas fa-bell mr-3"></i>
                    Coordonnées
                </a>
                <a href="adminVideo.html" class="flex items-center px-6 py-3 text-gray-700 hover:bg-gray-100 transition-colors">
                    <i class="fas fa-video mr-3"></i>
                    Nouvelle Vidéo
                </a>
                <a href="adminHistorique.html" class="flex items-center px-6 py-3 text-gray-700 hover:bg-gray-100 transition-colors">
                    <i class="fas fa-history mr-3"></i>
                    Mes Historiques
                </a>
                <a href="#" class="flex items-center px-6 py-3 text-bleu-principal bg-blue-50 border-r-3 border-bleu-principal">
                    <i class="fas fa-users mr-3"></i>
                    Utilisateurs
                </a>
                <a href="adminTransaction.html" class="flex items-center px-6 py-3 text-gray-700 hover:bg-gray-100 transition-colors">
                    <i class="fas fa-credit-card mr-3"></i>
                    Transactions
                </a>
                <a href="adminBonus.html" class="flex items-center px-6 py-3 text-gray-700 hover:bg-gray-100 transition-colors">
                    <i class="fas fa-gift mr-3"></i>
                    Bonus
                </a>
                <a href="adminVip.html" class="flex items-center px-6 py-3 text-gray-700 hover:bg-gray-100 transition-colors">
                    <i class="fas fa-crown mr-3"></i>
                    Utilisateurs VIP
                </a>
                <button id="btnDeco" class="w-full flex items-center px-6 py-3 text-red-600 hover:bg-red-50 transition-colors mt-8">
                    <i class="fas fa-sign-out-alt mr-3"></i>
                    Déconnexion
                </button>
            </nav>
        </aside>

        <div class="flex-1 lg:ml-64">
            <header class="bg-white shadow-sm border-b">
                <div class="flex items-center justify-between px-4 lg:px-6 py-4">
                    <div class="flex items-center">
                        <button id="btnOuvrir" class="lg:hidden text-gray-600 mr-4">
                            <i class="fas fa-bars text-xl"></i>
                        </button>
                        <h1 class="text-sm sm:text-xl lg:text-2xl font-semibold text-gray-800">Gestion Utilisateurs</h1>
                    </div>
                    <div class="flex items-center space-x-4">
                        <div class="relative">
                            <i class="fas fa-bell text-gray-600 text-lg lg:text-xl"></i>
                            <span class="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-4 w-4 flex items-center justify-center" id="notif">0</span>
                        </div>
                        <img src="https://img.freepik.com/vecteurs-premium/icone-profil-avatar-par-defaut-image-utilisateur-medias-sociaux-icone-avatar-gris-silhouette-profil-vide-illustration-vectorielle_561158-3383.jpg?uid=R99967860&semt=ais_hybrid&w=740" alt="Avatar" class="w-8 h-8 rounded-full">
                    </div>
                </div>
            </header>

            <main class="p-4 lg:p-6">
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                    <div class="bg-white rounded-lg shadow-md p-4 sm:p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-500 text-xs sm:text-sm">Total Utilisateurs</p>
                                <p class="text-2xl sm:text-3xl font-bold text-bleu-principal" id="nbTotal">0</p>
                            </div>
                            <div class="bg-blue-100 p-2 sm:p-3 rounded-full">
                                <i class="fas fa-users text-bleu-principal text-lg sm:text-xl"></i>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white rounded-lg shadow-md p-4 sm:p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-500 text-xs sm:text-sm">Aujourd'hui</p>
                                <p class="text-2xl sm:text-3xl font-bold text-green-600" id="nbAujourdhui">0</p>
                            </div>
                            <div class="bg-green-100 p-2 sm:p-3 rounded-full">
                                <i class="fas fa-user-plus text-green-600 text-lg sm:text-xl"></i>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white rounded-lg shadow-md p-4 sm:p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-500 text-xs sm:text-sm">Hier</p>
                                <p class="text-2xl sm:text-3xl font-bold text-orange-600" id="nbHier">0</p>
                            </div>
                            <div class="bg-orange-100 p-2 sm:p-3 rounded-full">
                                <i class="fas fa-user-clock text-orange-600 text-lg sm:text-xl"></i>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white rounded-lg shadow-md p-4 sm:p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-500 text-xs sm:text-sm">Ce mois</p>
                                <p class="text-2xl sm:text-3xl font-bold text-purple-600" id="nbMoisActuel">0</p>
                            </div>
                            <div class="bg-purple-100 p-2 sm:p-3 rounded-full">
                                <i class="fas fa-calendar-alt text-purple-600 text-lg sm:text-xl"></i>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="flex justify-end mb-5">
                    <button onclick="ouvrirModal()" class="bg-bleu-principal text-white px-3 py-2 sm:px-4 rounded-lg hover:bg-bleu-fonce transition-colors text-sm sm:text-base">
                        <i class="fas fa-plus mr-1 sm:mr-2"></i>
                        <span class="inline">Ajouter </span>Utilisateur
                    </button>
                </div>

                <div class="bg-white rounded-lg shadow-md">
                    <div class="px-4 py-3 sm:px-6 sm:py-4 border-b">
                        <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center gap-3">
                            <h2 class="text-lg sm:text-xl font-semibold text-gray-800">
                                Liste des Utilisateurs 
                                <span class="text-sm font-normal text-gray-500">(<span id="nbAffiche">0</span> affichés)</span>
                            </h2>
                            <div class="flex flex-col sm:flex-row gap-3">
                                <select id="filtrePeriode" class="px-3 py-2 border rounded-lg focus:ring-2 focus:ring-bleu-principal focus:border-transparent text-sm">
                                    <option value="tous">Tous</option>
                                    <option value="aujourdhui">Aujourd'hui</option>
                                    <option value="hier">Hier</option>
                                    <option value="moisActuel">Ce mois</option>
                                    <option value="moisDernier">Mois dernier</option>
                                </select>
                                <input type="text" id="inputRecherche" placeholder="Rechercher nom, email, téléphone..." class="w-full sm:w-80 px-3 py-2 border rounded-lg focus:ring-2 focus:ring-bleu-principal focus:border-transparent text-sm">
                            </div>
                        </div>
                    </div>

                    <div class="hidden lg:block overflow-x-auto">
                        <table class="w-full min-w-full">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-3 xl:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Utilisateur</th>
                                    <th class="px-3 xl:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Email</th>
                                    <th class="px-3 xl:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Téléphone</th>
                                    <th class="px-3 xl:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Ville</th>
                                    <th class="px-3 xl:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Naissance</th>
                                    <th class="px-3 xl:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Inscription</th>
                                    <th class="px-3 xl:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="tabUsers" class="bg-white divide-y divide-gray-200">
                            </tbody>
                        </table>
                    </div>

                    <div class="lg:hidden" id="mobUsers">
                    </div>

                    <div id="aucunResultat" class="text-center py-8 text-gray-500 hidden">
                        <i class="fas fa-search text-3xl mb-2"></i>
                        <p>Aucun utilisateur trouvé</p>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <div id="overlay" class="fixed inset-0 bg-black bg-opacity-50 z-20 hidden lg:hidden"></div>

    <div id="modalUser" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center p-4">
        <div class="bg-white rounded-lg shadow-xl max-w-md w-full max-h-[90vh] overflow-y-auto">
            <div class="px-6 py-4 border-b flex justify-between items-center">
                <h3 id="titreModal" class="text-lg font-semibold text-gray-800">Ajouter Utilisateur</h3>
                <button onclick="fermerModal()" class="text-gray-400 hover:text-gray-600">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            
            <form id="formUser" class="p-6 space-y-4">
                <input type="hidden" id="idUser" value="">
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Nom complet</label>
                    <input type="text" id="nomUser" class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-bleu-principal focus:border-transparent" required>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                    <input type="email" id="emailUser" class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-bleu-principal focus:border-transparent" required>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Téléphone</label>
                    <input type="tel" id="telUser" class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-bleu-principal focus:border-transparent" required>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Ville</label>
                    <input type="text" id="villeUser" class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-bleu-principal focus:border-transparent" required>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Date de naissance</label>
                    <input type="date" id="naissanceUser" class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-bleu-principal focus:border-transparent" required>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Mot de passe</label>
                    <input type="password" id="mdpUser" class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-bleu-principal focus:border-transparent">
                    <p class="text-xs text-gray-500 mt-1">Laisser vide pour conserver le mot de passe actuel</p>
                </div>
                
                <div class="flex justify-end space-x-3 pt-4">
                    <button type="button" onclick="fermerModal()" class="px-4 py-2 text-gray-600 border rounded-lg hover:bg-gray-50 transition-colors">
                        Annuler
                    </button>
                    <button type="submit" class="px-4 py-2 bg-bleu-principal text-white rounded-lg hover:bg-bleu-fonce transition-colors">
                        Enregistrer
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'bleu-principal': '#1e40af',
                        'bleu-fonce': '#1e3a8a'
                    }
                }
            }
        }

        let users = [
            { id: 1, nom: 'Jean Dupont', email: 'jean.dupont@email.com', tel: '+2250712345678', ville: 'Abidjan', naissance: '1990-05-15', inscription: '2025-06-09' },
            { id: 2, nom: 'Marie Martin', email: 'marie.martin@email.com', tel: '+2250523456789', ville: 'Bouaké', naissance: '1985-08-22', inscription: '2025-06-09' },
            { id: 3, nom: 'Pierre Durand', email: 'pierre.durand@email.com', tel: '+2250134567890', ville: 'Yamoussoukro', naissance: '1992-03-10', inscription: '2025-06-08' },
            { id: 4, nom: 'Sophie Leroy', email: 'sophie.leroy@email.com', tel: '+2250245678901', ville: 'San-Pédro', naissance: '1988-12-05', inscription: '2025-06-08' },
            { id: 5, nom: 'Ahmed Koné', email: 'ahmed.kone@email.com', tel: '+2250356789012', ville: 'Korhogo', naissance: '1995-07-12', inscription: '2025-06-07' },
            { id: 6, nom: 'Fatou Traoré', email: 'fatou.traore@email.com', tel: '+2250467890123', ville: 'Daloa', naissance: '1993-11-01', inscription: '2025-05-20' },
            { id: 7, nom: 'Yves Kouassi', email: 'yves.kouassi@email.com', tel: '+2250578901234', ville: 'Abidjan', naissance: '1987-09-18', inscription: '2025-05-15' },
            { id: 8, nom: 'Aïcha Ouattara', email: 'aicha.ouattara@email.com', tel: '+2250689012345', ville: 'Bouaké', naissance: '1991-06-30', inscription: '2025-05-10' },
            { id: 9, nom: 'Laurent Koffi', email: 'laurent.koffi@email.com', tel: '+2250790123456', ville: 'Man', naissance: '1989-04-25', inscription: '2025-04-28' },
            { id: 10, nom: 'Binta Diarra', email: 'binta.diarra@email.com', tel: '+2250801234567', ville: 'Gagnoa', naissance: '1994-02-14', inscription: '2025-04-15' },
            { id: 11, nom: 'Pascal Gbagbo', email: 'pascal.gbagbo@email.com', tel: '+2250912345678', ville: 'Abengourou', naissance: '1986-12-03', inscription: '2025-04-01' },
            { id: 12, nom: 'Ramatou Bamba', email: 'ramatou.bamba@email.com', tel: '+2250123456789', ville: 'Divo', naissance: '1992-08-19', inscription: '2025-03-22' },
            { id: 13, nom: 'Christian Attiéké', email: 'christian.attieke@email.com', tel: '+2250234567890', ville: 'Grand-Bassam', naissance: '1990-01-07', inscription: '2025-03-08' },
            { id: 14, nom: 'Mariame Fofana', email: 'mariame.fofana@email.com', tel: '+2250345678901', ville: 'Bondoukou', naissance: '1993-10-11', inscription: '2025-02-14' },
            { id: 15, nom: 'Serge Yapo', email: 'serge.yapo@email.com', tel: '+2250456789012', ville: 'Sassandra', naissance: '1988-07-23', inscription: '2025-01-30' }
        ];

        let usersFiltres = [...users];

        function obtenirDatesPeriode(periode) {
            const maintenant = new Date();
            const aujourd = new Date(maintenant.getFullYear(), maintenant.getMonth(), maintenant.getDate());
            
            switch(periode) {
                case 'aujourdhui':
                    return { 
                        debut: new Date(aujourd.getTime()), 
                        fin: new Date(aujourd.getTime() + 24 * 60 * 60 * 1000 - 1) 
                    };
                case 'hier':
                    const hier = new Date(aujourd.getTime() - 24 * 60 * 60 * 1000);
                    return { 
                        debut: hier, 
                        fin: new Date(hier.getTime() + 24 * 60 * 60 * 1000 - 1) 
                    };
                case 'moisActuel':
                    return { 
                        debut: new Date(maintenant.getFullYear(), maintenant.getMonth(), 1),
                        fin: new Date(maintenant.getFullYear(), maintenant.getMonth() + 1, 0, 23, 59, 59)
                    };
                case 'moisDernier':
                    return { 
                        debut: new Date(maintenant.getFullYear(), maintenant.getMonth() - 1, 1),
                        fin: new Date(maintenant.getFullYear(), maintenant.getMonth(), 0, 23, 59, 59)
                    };
                default:
                    return null;
            }
        }

        function compterParPeriode(periode) {
            const dates = obtenirDatesPeriode(periode);
            if (!dates) return users.length;
            
            return users.filter(u => {
                const dateInscr = new Date(u.inscription);
                return dateInscr >= dates.debut && dateInscr <= dates.fin;
            }).length;
        }

        function mettreAJourCartes() {
            document.getElementById('nbTotal').textContent = users.length;
            document.getElementById('nbAujourdhui').textContent = compterParPeriode('aujourdhui');
            document.getElementById('nbHier').textContent = compterParPeriode('hier');
            document.getElementById('nbMoisActuel').textContent = compterParPeriode('moisActuel');
            document.getElementById('nbAffiche').textContent = usersFiltres.length;
        }

        function afficherUsers() {
            const tab = document.getElementById('tabUsers');
            const mob = document.getElementById('mobUsers');
            const aucunResultat = document.getElementById('aucunResultat');
            
            tab.innerHTML = '';
            mob.innerHTML = '';

            if (usersFiltres.length === 0) {
                aucunResultat.classList.remove('hidden');
                return;
            } else {
                aucunResultat.classList.add('hidden');
            }

            usersFiltres.forEach(u => {
                const ligne = document.createElement('tr');
                ligne.className = 'hover:bg-gray-50 transition-colors';
                ligne.innerHTML = `
                    <td class="px-3 xl:px-6 py-4 whitespace-nowrap">
                        <div class="text-xs xl:text-sm font-medium text-gray-900">${u.nom}</div>
                    </td>
                    <td class="px-3 xl:px-6 py-4 whitespace-nowrap">
                        <div class="text-xs xl:text-sm text-gray-900" title="${u.email}">${u.email}</div>
                    </td>
                    <td class="px-3 xl:px-6 py-4 whitespace-nowrap">
                        <div class="text-xs xl:text-sm text-gray-900">${u.tel}</div>
                    </td>
                    <td class="px-3 xl:px-6 py-4 whitespace-nowrap">
                        <div class="text-xs xl:text-sm text-gray-900">${u.ville}</div>
                    </td>
                    <td class="px-3 xl:px-6 py-4 whitespace-nowrap">
                        <div class="text-xs xl:text-sm text-gray-900">${new Date(u.naissance).toLocaleDateString('fr-FR')}</div>
                    </td>
                    <td class="px-3 xl:px-6 py-4 whitespace-nowrap">
                        <div class="text-xs xl:text-sm text-gray-500">${new Date(u.inscription).toLocaleDateString('fr-FR')}</div>
                    </td>
                    <td class="px-3 xl:px-6 py-4 whitespace-nowrap">
                        <div class="flex flex-col xl:flex-row gap-1 xl:gap-2">
                            <button onclick="modifierUser(${u.id})" class="bg-blue-600 text-white px-2 py-1 rounded hover:bg-blue-700 transition-colors text-xs">
                                <i class="fas fa-edit mr-1"></i><span class="hidden xl:inline">Modifier</span>
                            </button>
                            <button onclick="supprimerUser(${u.id})" class="bg-red-600 text-white px-2 py-1 rounded hover:bg-red-700 transition-colors text-xs">
                                <i class="fas fa-trash mr-1"></i><span class="hidden xl:inline">Supprimer</span>
                            </button>
                        </div>
                    </td>
                `;
                tab.appendChild(ligne);

                const carte = document.createElement('div');
                carte.className = 'border-b border-gray-200 p-4 hover:bg-gray-50 transition-colors';
                carte.innerHTML = `
                    <div class="space-y-3">
                        <div class="flex items-start space-x-3">
                            <div class="flex-1">
                                <p class="font-medium text-gray-900">${u.nom}</p>
                                <p class="text-sm text-gray-600">${u.email}</p>
                                <p class="text-sm text-gray-600">${u.tel}</p>
                                <p class="text-sm text-gray-600">${u.ville} - Né(e) le ${new Date(u.naissance).toLocaleDateString('fr-FR')}</p>
                            </div>
                        </div>
                        <div class="flex justify-between items-center">
                            <p class="text-sm text-gray-500">Inscrit le ${new Date(u.inscription).toLocaleDateString('fr-FR')}</p>
                            <div class="flex space-x-2">
                                <button onclick="modifierUser(${u.id})" class="bg-blue-600 text-white px-3 py-1 rounded hover:bg-blue-700 transition-colors text-xs">
                                    <i class="fas fa-edit mr-1"></i>Modifier
                                </button>
                                <button onclick="supprimerUser(${u.id})" class="bg-red-600 text-white px-3 py-1 rounded hover:bg-red-700 transition-colors text-xs">
                                    <i class="fas fa-trash mr-1"></i>Supprimer
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                mob.appendChild(carte);
            });
        }

        function filtrerUsers() {
            const recherche = document.getElementById('inputRecherche').value.toLowerCase().trim();
            const periode = document.getElementById('filtrePeriode').value;

            usersFiltres = users.filter(u => {
                const correspondRecherche = recherche === '' ||
                    u.nom.toLowerCase().includes(recherche) || 
                    u.email.toLowerCase().includes(recherche) || 
                    u.tel.includes(recherche) ||
                    u.ville.toLowerCase().includes(recherche);

                if (periode === 'tous') {
                    return correspondRecherche;
                }

                const dates = obtenirDatesPeriode(periode);
                if (!dates) return correspondRecherche;

                const dateInscr = new Date(u.inscription);
                return correspondRecherche && dateInscr >= dates.debut && dateInscr <= dates.fin;
            });

            afficherUsers();
            mettreAJourCartes();
        }

        function ouvrirModal(idUser = null) {
            const modal = document.getElementById('modalUser');
            const titre = document.getElementById('titreModal');
            const form = document.getElementById('formUser');
            
            form.reset();
            
            if (idUser) {
                const user = users.find(u => u.id === idUser);
                if (user) {
                    titre.textContent = 'Modifier Utilisateur';
                    document.getElementById('idUser').value = user.id;
                    document.getElementById('nomUser').value = user.nom;
                    document.getElementById('emailUser').value = user.email;
                    document.getElementById('telUser').value = user.tel;
                    document.getElementById('villeUser').value = user.ville;
                    document.getElementById('naissanceUser').value = user.naissance;
                    document.getElementById('mdpUser').value = '';
                }
            } else {
                titre.textContent = 'Ajouter Utilisateur';
                document.getElementById('idUser').value = '';
            }
            
            modal.classList.remove('hidden');
        }

        function fermerModal() {
            document.getElementById('modalUser').classList.add('hidden');
        }

        function modifierUser(id) {
            ouvrirModal(id);
        }

        function supprimerUser(id) {
            if (confirm('Êtes-vous sûr de vouloir supprimer cet utilisateur ?')) {
                users = users.filter(u => u.id !== id);
                filtrerUsers();
            }
        }

        function genererNouvelId() {
            return Math.max(...users.map(u => u.id)) + 1;
        }

        document.getElementById('formUser').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const idUser = document.getElementById('idUser').value;
            const nom = document.getElementById('nomUser').value.trim();
            const email = document.getElementById('emailUser').value.trim();
            const tel = document.getElementById('telUser').value.trim();
            const ville = document.getElementById('villeUser').value.trim();
            const naissance = document.getElementById('naissanceUser').value;
            const mdp = document.getElementById('mdpUser').value;

            if (!nom || !email || !tel || !ville || !naissance) {
                alert('Veuillez remplir tous les champs obligatoires');
                return;
            }

            // Vérifier l'unicité de l'email (sauf pour l'utilisateur en cours de modification)
            const emailExiste = users.some(u => u.email === email && u.id != idUser);
            if (emailExiste) {
                alert('Cet email est déjà utilisé par un autre utilisateur');
                return;
            }

            if (idUser) {
                // Modification
                const index = users.findIndex(u => u.id == idUser);
                if (index !== -1) {
                    users[index] = {
                        ...users[index],
                        nom: nom,
                        email: email,
                        tel: tel,
                        ville: ville,
                        naissance: naissance
                    };
                }
            } else {
                // Ajout
                const nouvelUser = {
                    id: genererNouvelId(),
                    nom: nom,
                    email: email,
                    tel: tel,
                    ville: ville,
                    naissance: naissance,
                    inscription: new Date().toISOString().split('T')[0]
                };
                users.push(nouvelUser);
            }

            filtrerUsers();
            fermerModal();
        });

        // Gestion du menu mobile
        document.getElementById('btnOuvrir').addEventListener('click', function() {
            document.getElementById('menu').classList.remove('-translate-x-full');
            document.getElementById('overlay').classList.remove('hidden');
        });

        document.getElementById('btnFermer').addEventListener('click', function() {
            document.getElementById('menu').classList.add('-translate-x-full');
            document.getElementById('overlay').classList.add('hidden');
        });

        document.getElementById('overlay').addEventListener('click', function() {
            document.getElementById('menu').classList.add('-translate-x-full');
            document.getElementById('overlay').classList.add('hidden');
        });

        // Gestion de la déconnexion
        document.getElementById('btnDeco').addEventListener('click', function() {
            if (confirm('Êtes-vous sûr de vouloir vous déconnecter ?')) {
                // Redirection vers la page de connexion
                window.location.href = 'index.html';
            }
        });

        // Event listeners pour les filtres
        document.getElementById('inputRecherche').addEventListener('input', filtrerUsers);
        document.getElementById('filtrePeriode').addEventListener('change', filtrerUsers);

        // Fermer le modal avec Escape
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                fermerModal();
            }
        });

        // Fermer le modal en cliquant à l'extérieur
        document.getElementById('modalUser').addEventListener('click', function(e) {
            if (e.target === this) {
                fermerModal();
            }
        });

        // Initialisation
        document.addEventListener('DOMContentLoaded', function() {
            filtrerUsers();
        });

        // Empêcher la fermeture accidentelle du modal
        document.querySelector('#modalUser .bg-white').addEventListener('click', function(e) {
            e.stopPropagation();
        });
    </script>
</body>
</html>